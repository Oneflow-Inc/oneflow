include (ExternalProject)
set(LIBHDFS3_PATCH_DIR ${CMAKE_CURRENT_SOURCE_DIR}/cmake/patches/libhdfs3)
set(LIBHDFS3_SOURCE_DIR ${CMAKE_CURRENT_BINARY_DIR}/libhdfs3/src/libhdfs3)
set(LIBHDFS3_INCLUDE_DIR ${THIRD_PARTY_DIR}/libhdfs3/include)
set(LIBHDFS3_LIBRARY_DIR ${THIRD_PARTY_DIR}/libhdfs3/lib)
set(LIBHDFS3_INSTALL_DIR ${THIRD_PARTY_DIR}/libhdfs3/)
set(LIBHDFS3_HEADERS_DIR ${CMAKE_CURRENT_BINARY_DIR}/libhdfs3/src/libhdfs3/include)
set(LIBHDFS3_LIB_DIR ${CMAKE_CURRENT_BINARY_DIR}/libhdfs3/src/libhdfs3/lib)
set(LIBHDFS3_URL http://download.oneflow.org/incubator-hawq-depends-libhdfs3-master.tar.gz)
if(WIN32)
    set(LIBHDFS3_BUILD_LIBRARY_DIR ${LIBHDFS3_LIB_DIR}/${CMAKE_BUILD_TYPE})
    set(LIBHDFS3_LIBRARY_NAMES libhdfs3_static.lib)
elseif(APPLE AND ("${CMAKE_GENERATOR}" STREQUAL "Xcode"))
    set(LIBHDFS3_BUILD_LIBRARY_DIR ${LIBHDFS3_LIB_DIR}/${CMAKE_BUILD_TYPE})
    set(LIBHDFS3_LIBRARY_NAMES libhdfs3.a)
else()
    set(LIBHDFS3_BUILD_LIBRARY_DIR ${LIBHDFS3_LIB_DIR})
    set(LIBHDFS3_LIBRARY_NAMES libhdfs3.a)
endif()
 foreach(LIBRARY_NAME ${LIBHDFS3_LIBRARY_NAMES})
    list(APPEND LIBHDFS3_STATIC_LIBRARIES ${LIBHDFS3_LIBRARY_DIR}/${LIBRARY_NAME})
    list(APPEND LIBHDFS3_BUILD_STATIC_LIBRARIES ${LIBHDFS3_BUILD_LIBRARY_DIR}/${LIBRARY_NAME})
endforeach()
 if (BUILD_THIRD_PARTY)
 find_program(MAKE_COMMAND NAMES gmake nmake cmake)
 ExternalProject_Add(libhdfs3
    PREFIX libhdfs3
    DEPENDS protobuf
    URL ${LIBHDFS3_URL}
    # PATCH_COMMAND ${CMAKE_COMMAND} -E copy_if_different ${LIBHDFS3_PATCH_DIR}/CMakeLists.txt ${LIBHDFS3_SOURCE_DIR}
    UPDATE_COMMAND ""
    BUILD_IN_SOURCE 0
    CMAKE_CACHE_ARGS
        -DCMAKE_INSTALL_PREFIX:STRING=${LIBHDFS3_INSTALL_DIR}
        -DCMAKE_BUILD_TYPE:STRING=${CMAKE_BUILD_TYPE}
        -DCMAKE_CXX_FLAGS_DEBUG:STRING=${CMAKE_CXX_FLAGS_DEBUG}
        -DCMAKE_CXX_FLAGS_RELEASE:STRING=${CMAKE_CXX_FLAGS_RELEASE}
        -DLIBHDFS3_NAMESPACE:STRING=libhdfs3
        -DCMAKE_VERBOSE_MAKEFILE:BOOL=OFF
)
 endif(BUILD_THIRD_PARTY)

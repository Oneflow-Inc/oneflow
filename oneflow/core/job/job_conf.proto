syntax = "proto2";
package oneflow;

import "oneflow/core/operator/op_conf.proto";
import "oneflow/core/common/data_type.proto";

enum RegularizationMethod {
  kNone = 0;
  kL1 = 1;
  kL2 = 2;
}

message TrainConf {
  required string model_save_snapshots_path = 1;
  required int32 num_of_batches_in_snapshot = 2;
  optional int32 staleness = 3 [default = 0]; // -1 means unlimited, 0 means BSP, > 0 means SSP
  required int64 total_batch_num = 4;
  optional FillConf default_fill_conf = 5;
  optional int32 piece_num_of_print_loss = 6 [default = 100];
  required int32 num_of_pieces_in_batch = 7;
  required RegularizationMethod regularization_method = 8 [default = kNone];
  required float weight_decay = 9 [default = 0];

  oneof ModelUpdateCase {
    NormalModelUpdateOpConf normal_mdupdt_conf = 1000;
    MomentumModelUpdateOpConf momentum_mdupdt_conf = 1001;
    RMSPropModelUpdateOpConf rmsprop_mdupdt_conf = 1002;
  }
}

message PredictConf {
}

message LocalFsConf {
}

message HdfsConf {
  required string namenode = 1;
}

message GlobalFSConf {
  oneof fs_type {
    LocalFsConf localfs_conf = 1;
    HdfsConf hdfs_conf = 2;
  }
}

message JobConf {
  required string dlnet_filepath = 1;
  required string resource_filepath = 2;
  required string placement_filepath = 3;
  required GlobalFSConf global_fs_conf = 4;
  required int32 single_piece_size = 5;
  required int32 data_part_num = 6;
  optional string model_load_snapshot_path = 7 [default = ""];
  optional int32 max_data_id_length = 8 [default = 0];
  optional bool use_rdma = 9 [default = false];

  optional DataType default_data_type = 100 [default = kFloat]; // kFloat or kDouble
  optional int64 piece_num_of_experiment_phase = 101 [default = 100];
  oneof JobType {
    TrainConf train_conf = 1000;
    PredictConf predict_conf = 1001;
  }
}

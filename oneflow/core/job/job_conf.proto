syntax = "proto3";
package oneflow;

import "oneflow/core/operator/op_conf.proto";
import "oneflow/core/common/data_type.proto";

message TrainConf {
  string model_save_snapshots_path = 1;
  int32 num_of_batches_in_snapshot = 2;
  int32 staleness = 3; // at least 0. If set as 0, then it's BSP
  int64 total_batch_num = 4;
  FillConf default_fill_conf = 5;
  int32 piece_num_of_record_loss = 6;
  oneof ModelUpdateCase {
    NormalModelUpdateOpConf normal_mdupdt_conf = 1000;
    MomentumModelUpdateOpConf momentum_mdupdt_conf = 1001;
    RMSPropModelUpdateOpConf rmsprop_mdupdt_conf = 1002;
  }
}

message PredictConf {
}

message JobConf {
  string dlnet_filepath = 1;
  string resource_filepath = 2;
  string placement_filepath = 3;
  string model_load_snapshot_path = 4;
  int32 piece_size = 5;
  int32 num_of_pieces_in_batch = 6;
  DataType default_data_type = 7; // kFloat or kDouble
  bool use_async_cpu_stream = 8;
  int32 max_data_id_length = 9;
  oneof JobType {
    TrainConf train_conf = 1000;
    PredictConf predict_conf = 1001;
  }
}

syntax = "proto2";
package oneflow;

import "oneflow/core/operator/op_conf.proto";

message BlobDataParallel {
  optional int64 data_split_num = 1 [default = 1];
  optional int64 clone_num = 2 [default = 1];
}

message BlobModelParallel {
  optional int64 clone_num = 1 [default = 1];
  optional int64 model_split_num = 2 [default = 1];
}

message BlobGridParallel {
  required int64 data_split_num = 1;
  required int64 model_split_num = 2;
}

message BlobParallelConf {
  optional int64 model_split_axis = 1 [default = 1];
  oneof parallel_type {
    BlobDataParallel data_parallel = 2;
    BlobModelParallel model_parallel = 3;
    BlobGridParallel grid_parallel = 4;
  }
}

enum ParallelPolicy {
  kInvalidParallel = 0;
  kDataParallel = 1;
  kModelParallel = 2;
}

message RankContext {
  required int64 rank_set_id = 1;
  required int64 rank_id = 2;
  required int64 rank_num = 3;
}

message ParallelContext {
  required int64 parallel_id = 1;
  required int64 parallel_num = 2;
  required ParallelPolicy policy = 3;
  optional RankContext rank_ctx = 4;
}

message ParallelConf {
  required ParallelPolicy policy = 1;
  repeated string device_name = 2;
}

message PlacementGroup {
  required OpNameSet op_set = 1;
  required ParallelConf parallel_conf = 2;
}

message Placement {
  repeated PlacementGroup placement_group = 1;
}

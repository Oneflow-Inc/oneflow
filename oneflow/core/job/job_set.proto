syntax = "proto2";
package oneflow;

import "oneflow/core/job/job.proto";
import "oneflow/core/job/resource.proto";

message LocalFsConf {
}

message NetworkFsConf {
}

message HdfsConf {
  required string namenode = 1;
}

message FileSystemConf {
  oneof fs_type {
    LocalFsConf localfs_conf = 1;
    NetworkFsConf networkfs_conf = 2;
    HdfsConf hdfs_conf = 3;
  }
}

message IOConf {
  required FileSystemConf data_fs_conf = 1;
  required FileSystemConf snapshot_fs_conf = 2;
  optional string model_load_snapshot_path = 3 [default = ""];
  optional string model_save_snapshots_path = 4 [default = "./model_save"];
  optional bool enable_write_snapshot = 5 [default = true];
  optional bool save_downloaded_file_to_local_fs = 6 [default = false];
  optional uint64 persistence_buf_byte = 7 [default = 67108864]; // 64M
}

message ProfilerConf {
  optional bool collect_act_event = 1 [default = false];
}

message MemSharingPriorityStrategy {
}

message ParallelismPriorityStrategy {
}

message JobNameGroup {
  repeated string job_name = 1;
}

message CustomParallelismStrategy {
  repeated JobNameGroup nonparallel_group = 1;
}

message JobMemSharingStrategy {
  oneof strategy_case {
    MemSharingPriorityStrategy mem_sharing_priority = 1;
    ParallelismPriorityStrategy parallelism_priority = 2;
    CustomParallelismStrategy custom_parallelism = 3;
  }
}

message CppFlagsConf {
  // glog
  optional string log_dir = 1 [default = "./log"];
  optional int32 logtostderr = 2 [default = 0];
  optional int32 logbuflevel = 3 [default = -1];
  optional int32 v = 4 [default = 0];

  // grpc
  optional bool grpc_use_no_signal = 5 [default = false];
}

message ConfigProto {
  required Resource resource = 1;
  required IOConf io_conf = 2;
  required CppFlagsConf cpp_flags_conf = 3;
  optional ProfilerConf profiler_conf = 4;
}

message JobSet {
  repeated Job job = 1;
  optional JobMemSharingStrategy job_mem_sharing_strategy = 5;
}

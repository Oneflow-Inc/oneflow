syntax = "proto2";
package oneflow;

import "oneflow/core/operator/op_conf.proto";
import "oneflow/core/common/data_type.proto";

message MultinomialLogisticLossKernelConf { 
  required DataType prediction_type = 1;
  required DataType label_type = 2;
}

message BoxingKernelConf {
  required DataType data_type = 1;
  required int64 in_seg_cnt = 2;
  required int64 out_seg_cnt = 3;
  required int64 in_seg_size = 4;
  required int64 out_seg_size = 5;
  repeated int64 in_offset_in_seg = 6;
  repeated int64 out_size_in_seg = 7;
}

message KernelConf {
  required OperatorConf op_conf = 1;
  map<string, string> bn_in_op2lbn = 2;
  
  repeated string data_tmp_bns = 3;
  repeated string input_bns = 4;
  repeated string input_diff_bns = 5;
  repeated string output_bns = 6;
  repeated string output_diff_bns = 7;

  repeated string model_bns = 8;
  repeated string model_diff_bns = 9;
  repeated string model_tmp_bns = 10;

  required bool need_do_data_id = 12;
  required bool is_forward = 13;
  required DataType data_type = 14;
  
  oneof kernel_type {
    ConvolutionKernelConf convolution_conf = 100;
    InnerProductKernelConf innerproduct_conf = 101;
    DataLoaderKernelConf data_loader_conf = 102;
    BoxingKernelConf boxing_conf = 103;
    MultinomialLogisticLossKernelConf multinomial_logistic_loss_conf = 106;
  }
}
